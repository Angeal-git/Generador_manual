// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Material: Catálogo de materiales con precios
model Material {
  id                String             @id @default(cuid())
  nombre            String             // e.g., "MDF 15mm"
  tipo              String             // e.g., "Madera", "Metal", "Plástico"
  unidad            String             // e.g., "m²", "metro lineal", "pieza"
  precioPorUnidad   Float              // Precio base calculado (por m², ml, etc.)
  
  // Datos de Venta (Nuevo)
  unidadVenta             String?      // e.g., "placa", "barra", "rollo"
  cantidadPorUnidadVenta  Float?       // e.g., 2.97 (m² por placa)
  precioPorUnidadVenta    Float?       // Precio de venta real (por placa, barra, etc.)

  // Dimensiones y Stock (Nuevo)
  ancho                   Float?       // Ancho en metros
  alto                    Float?       // Alto o Largo en metros
  stockCantidad           Float?       // Cantidad en unidades de venta (e.g., 2 placas)

  proveedor         String?
  especificaciones  String?
  enStock           Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  
  // Relaciones
  componentesUsados ProjectComponent[]
  
  @@index([tipo])
}

// Consumable: Tornillos, pegamento, pintura, etc.
model Consumable {
  id                String             @id @default(cuid())
  nombre            String             // e.g., "Tornillo 3x20mm"
  tipo              ConsumableType
  unidad            String             // e.g., "pieza", "litro", "kg"
  precioPorUnidad   Float
  cantidadMinima    Float?             // Para alertas de stock
  especificaciones  String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  
  // Relaciones
  proyectosUsados   ProjectConsumable[]
  
  @@index([tipo])
}

// Project: Proyectos guardados
model Project {
  id                    String              @id @default(cuid())
  nombre                String
  descripcion           String?
  dimensionesFrente     Float
  dimensionesFondo      Float
  dimensionesAltura     Float
  especificaciones      String?
  
  // Manual generado (JSON)
  manualData            Json                // ProductionManual completo
  svgFiles              Json?               // { [componentId]: svgString }
  costsData             Json?               // Detalle completo de costos (CostBreakdown)
  
  // Imágenes originales
  imageUrls             String[]            // URLs de las imágenes subidas
  
  // Costos
  costoMateriales       Float               @default(0)
  costoConsumibles      Float               @default(0)
  costoManoDeObra       Float               @default(0)
  costoTotal            Float               @default(0)
  
  // Metadata
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  // Relaciones
  componentes           ProjectComponent[]
  consumibles           ProjectConsumable[]
  
  @@index([createdAt])
}

// ProjectComponent: Componentes usados en un proyecto
model ProjectComponent {
  id            String   @id @default(cuid())
  projectId     String
  materialId    String
  
  // Datos del componente
  nombre        String
  cantidad      Float    // Cantidad de material usado
  unidad        String
  costo         Float    // Costo calculado
  
  // Relaciones
  project       Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  material      Material @relation(fields: [materialId], references: [id])
  
  @@index([projectId])
  @@index([materialId])
}

// ProjectConsumable: Consumibles usados en un proyecto
model ProjectConsumable {
  id            String     @id @default(cuid())
  projectId     String
  consumableId  String
  
  cantidad      Float
  costo         Float
  
  // Relaciones
  project       Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  consumable    Consumable @relation(fields: [consumableId], references: [id])
  
  @@index([projectId])
  @@index([consumableId])
}

enum ConsumableType {
  ILUMINACION
  PINTURA
  ADHESIVO
  TORNILLERIA
  OTRO
}
